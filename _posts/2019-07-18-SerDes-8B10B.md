---
title: 8B10B
categories: 接口设计
date: 2019-07-18 
---
## 8B10B 
当前主流的高速串行总线通信标准通常都采用8B/10B这类编码进行数据传输，例如USB3.0、1394B、SATA、PCIExpress、Infini-band、Fibre Channel、RapidlO。在无线通信系统中，8B/10B编码被广泛应用于基站射频与基带之间的接口()R接口）。所有的主流无线通信厂商在3G、4G/LTE设备中，均采用CPRI标准完成基带与射频的交互，而CPRI最终的编码基础就是8B/10B。

8B/10B与传统的信道编码表现形式有很大的不同，但由于应用广泛，而且充分体现了信
道编码的冗余空间映射思想，因此在此作为最基础的人门内容进行论述。

8B/10B编码本质上是一种将8位数据映射成10位的表示方法，主要目的是保证传输序列
电平的平衡性，其特点包括如下：


1. 0/1转换密度高：每一个编码完毕的数据至少有3至8次的0/1转换。


2. 数据序列直流平衡：编码后数据中的0/1数量基本一致，连续的0/1不会超过5位，从而保证信号的直流平衡，能够满足高速信号传输的需求。


3. 具备检错能力：8B/10B编码后的10位数据有1024种可能的码型，其中只有536种有效码字，接收端可以通过接收码字来检测传输是否出错


4. 具备控制信令：控制信令采用特殊码字表示，与数据传输存在区别；信令控制字符可用作帧同步字符或其他的分隔符等。
 
8B/10B编码包含两种实现方案：一种是逻辑电路，另一种是查找表。如果采用逻辑电路实现，就需要化简8B/10B映射的卡诺图，这会形成大扇入大扇出的逻辑表，在低频时钟下可以接受，但很难工作于高频时钟；如果用查找表方式，原理与设计均十分简单，但需要消耗部分ROM目前的FPGA实现推荐采用查找表的方法。

在实际应用中，8B/10B编码会将8位原始数据分成两部分，其中低5位进行5B/6B编码，高3位进行3B/4B编码，这等效于将原始8位中的高位3位数据映射为4位，低位5位数据映射为6位。8B/10B进行此类拆分的目的是为了保证映射规则的简单，同时还为了方便直流平衡。

所谓直流平衡就是数据位中的0与1的个数相等；而不平衡度则可以表示为数据位中0的个数减去1的个数。如果8B/10B编码后的4位和6位的数据分组中0与1的个数相等，则称为完美直流平衡代码，无需补偿。直流平衡的最大好处是可以克服：当高速串行流的逻辑]或0持续多位没有产生变化时，信号的转换就会因为直流偏置的关系而造成信号判决错误8B/10B编码的4位子分组（由3位映射而成）包含16种编码，但只有6种是完美平衡
的，而原始的3位总共有8种编码值，缺两组值。同样，6位子分组（由5位映射而成）也只有20种编码是完美平衡的，而5位总共有32种编码值，缺12组表示

由于4位和6位的两个子分组都是偶数个位数，而不平衡度不可能是+1或一1，因此，在8B/10B编码方案中还要使用不平衡度为+2和-2的值。在编码过程中，用一个极性偏差（RunningDisparity，RD）参数表示不平衡度，在不平衡时用2个10位字符表示一个8位字符，其中一个称为RD一，表示1的个数比0的个数多2个，另一个称为RD+，表示0的个数比1的个数多2个。

8B/10B编码方法是把8位代码组合编码成10位代码，代码组合包含256个数据字符编码和12个控制字符编码，分别记为Dx.y和Kx.y。8B/10B编码方案是把8位数据分成两个子分组：3个最高有效位(y)和5个最低有效位（x）。代码字按顺序排列，从最高有效位到最低有效位分别记为G、F和E、D、C、B、A。3位的子分组编码成4位，记为j、h、g、f；5位的子分组编码成6位，记为i、e、d、c、b、a，其映射关系如图4一4所示，4位和6位的子分组再组合成10位的编码值。因此，对于5B/6B的编码范围是DO~D31，而后面跟着的3B/4B，其编码范围为Dx.0~Dx.7。对于控制编码，可以认为是一类特殊映射，属于事先规划，只是映射规则与数据编码完全一样，通常采用查表方式实现例如D1.1=001 00001，D6.3=011 00110，K28.1=001 11100。下图为8B/10B的编码示意图。

![pic](https://raw.githubusercontent.com/njustzsqimq/njustzsqimq.github.io/master/_posts/images/8B10B_1.png)

仔细观察上面的编码表，会发现部分编码的输出有两列：RD+和RD一。这就是8B/10B的一个关键性设计：通过计算本次数据的RD，决定选择哪一列RD作为输出。RD（Run Disparity）就是不平衡度，即本次编码中0与1的个数差异数量。目前有正不平衡度RD+和负不平衡度RD-两种表示。RD-表示码输出中1的个数大于等于0的个数，RD+表示编码输出中1的个数小于等于0的个数。0、1个数相等的编码输出称为完美平衡码。编码器通过不平衡度控制位选择当前的编码输出。不平衡度控制位受前一周期的输出码型及不平衡度控制位的影响。通常，编码器复位后，不平衡度控制位初始化为负极性不平衡度RD-o若当前不平衡度控制位为负，则编码器在编码时会选择不平衡度为负的编码输出结果，同时判断输出是否为完美平衡码，若是，则不平衡度控制位保持不变；否则，不平衡度控制位取反。同样，当前不平衡度控制位为正时，选择不平衡度为正的编码输出，再根据输出是否为完美平衡码来决定不平衡度控制位是否取反。这样通过交替使用RD+和RD-的编码输出来保证输出的直流平衡。RD的状态机转换如下图所示。

